async function initCamera() {
  stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
  video.srcObject = stream;
  await video.play();
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  previewCanvas.width = video.videoWidth;
  previewCanvas.height = video.videoHeight;
  track = stream.getVideoTracks()[0];

  const capabilities = track.getCapabilities();
  if (capabilities.zoom) {
    document.getElementById('zoomControl').min = capabilities.zoom.min;
    document.getElementById('zoomControl').max = capabilities.zoom.max;
    document.getElementById('zoomControl').step = capabilities.zoom.step || 0.1;
    document.getElementById('zoomControl').value = capabilities.zoom.min;
    document.getElementById('zoomControl').oninput = e => 
      track.applyConstraints({ advanced: [{ zoom: e.target.value }] });
  } else {
    document.getElementById('zoomControl').style.display = 'none';
  }

  let flashOn = false;
  document.getElementById('toggleFlash').onclick = async () => {
    const capabilities = track.getCapabilities();
    if (capabilities.torch) {
      flashOn = !flashOn;
      await track.applyConstraints({ advanced: [{ torch: flashOn }] });
      document.getElementById('toggleFlash').textContent = flashOn ? 'DÃ©sactiver Flash' : 'Activer Flash';
    } else {
      alert("Flash non disponible sur cet appareil.");
    }
  };
}
